package com.cnpm.controller;

import java.util.HashMap;
import java.util.Optional;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import com.cnpm.utils.*;
import com.cnpm.model.Room;
import com.cnpm.service.RoomService;

@Controller
public class StayController {
	@Autowired
	private RoomService roomService;
	@GetMapping
    public String addItem(Model model , HttpSession session, @PathVariable("roomId") int roomId) {
		 HashMap<Integer, Stay> stayItems = (HashMap<Integer, Stay>) session.getAttribute("myStayItems");
	        if (stayItems == null) {
	        	stayItems = new HashMap<>();
	        }
	        Optional<Room> room= roomService.findById(roomId);
	        if (room != null) {
	            if (stayItems.containsKey(roomId)) {
	                Stay item = stayItems.get(roomId);
	                item.setRoom(room);
	                item.setQuantity(item.getQuantity() + 1);
	                stayItems.put(roomId, item);
	            } else {
	                Stay item = new Stay();
	                item.setRoom(room);
	                item.setQuantity(1);
	                stayItems.put(roomId, item);
	            }
	        }
	        session.setAttribute("myStayItems", stayItems);
	        
	        session.setAttribute("myStayNum", stayItems.size());
	        
        return "stay";
    }
}
